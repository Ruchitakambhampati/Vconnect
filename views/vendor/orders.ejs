

<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1"><%= __('Vendors orders') %></h1>
            <p class="text-muted mb-0">
                <%= __('orders') %>
            </p>
        </div>
        <div>
            <a href="/vendor/contracts" class="btn btn-primary">
                <i data-feather="plus" class="me-2"></i>
                <%= __('place new order') %>
            </a>
        </div>
    </div>

    <!-- Order Statistics -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card border-left-primary">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="text-primary fw-bold h4" id="free-attempts-display">
                                <%= freeAttemptsRemaining %>
                            </div>
                            <div class="text-muted small">
                                <i data-feather="gift" class="me-1"></i>
                                <%= __('freeAttempts') %>
                            </div>
                        </div>
                        <div class="text-primary">
                            <i data-feather="gift" style="width: 32px; height: 32px;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- <div class="col-md-3">
            <div class="card border-left-warning">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="text-warning fw-bold h4" id="cancellations-display">
                                <%= cancellationsRemaining %>
                            </div>
                            <div class="text-muted small">
                                <i data-feather="x-circle" class="me-1"></i>
                                <%= __('cancellationsLeft') %>
                            </div>
                        </div>
                        <div class="text-warning">
                            <i data-feather="x-circle" style="width: 32px; height: 32px;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        
        <div class="col-md-3">
            <div class="card border-left-success">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="text-success fw-bold h4">
                                <%= orders.filter(o => o.status === 'delivered').length %>
                            </div>
                            <div class="text-muted small">
                                <i data-feather="check-circle" class="me-1"></i>
                                <%= __('completed') %>
                            </div>
                        </div>
                        <div class="text-success">
                            <i data-feather="check-circle" style="width: 32px; height: 32px;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card border-left-info">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="text-info fw-bold h4">
                                <%= orders.filter(o => ['pending', 'confirmed'].includes(o.status)).length %>
                            </div>
                            <div class="text-muted small">
                                <i data-feather="clock" class="me-1"></i>
                                <%= __('active') %>
                            </div>
                        </div>
                        <div class="text-info">
                            <i data-feather="clock" style="width: 32px; height: 32px;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Orders Table -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i data-feather="list" class="me-2"></i>
                <%= __('myOrders') %>
            </h5>
            <div class="d-flex gap-2">
                <select class="form-select form-select-sm" id="statusFilter" style="width: auto;">
                    <option value=""><%= __('allStatuses') %></option>
                    <option value="pending"><%= __('pending') %></option>
                    <option value="confirmed"><%= __('confirmed') %></option>
                    <option value="delivered"><%= __('delivered') %></option>
                    <option value="cancelled"><%= __('cancelled') %></option>
                </select>
                <button class="btn btn-sm btn-outline-secondary" onclick="window.print()">
                    <i data-feather="printer" class="me-1"></i>
                    <%= __('print') %>
                </button>
            </div>
        </div>
        <div class="card-body">
            <% if (orders && orders.length > 0) { %>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th><%= __(' orderId') %></th>
                                <th><%= __(' product') %></th>
                                <th><%= __(' wholesaler') %></th>
                                <th><%= __(' quantity') %></th>
                                <th><%= __(' amount') %></th>
                                <th><%= __(' status') %></th>
                                <th><%= __(' deliveryDate') %></th>
                                <!-- <th><%= __(' actions') %></th> -->
                            </tr>
                        </thead>
                        <tbody>
                            <% orders.forEach(order => { %>
                                <tr class="order-row" data-status="<%= order.status %>">
                                    <td>
                                        <strong>#<%= order.id %></strong>
                                        <br>
                                        <small class="text-muted">
                                            <%= new Date(order.created_at).toLocaleDateString() %>
                                        </small>
                                    </td>
                                    <td>
                                        <strong><%= order.product_name %></strong>
                                        <br>
                                        <small class="text-muted">₹<%= order.price_per_unit %> per unit</small>
                                    </td>
                                    <td>
                                        <%= order.wholesaler_name %>
                                        <% if (order.business_name) { %>
                                            <br><small class="text-muted"><%= order.business_name %></small>
                                        <% } %>
                                    </td>
                                    <td>
                                        <span class="fw-bold"><%= order.quantity %></span> units
                                    </td>
                                    <td>
                                        <span class="fw-bold text-success">₹<%= order.total_amount.toLocaleString() %></span>
                                    </td>
                                    <td>
                                        <span class="status-badge status-<%= order.status %>">
                                            <%= __('status.' + order.status) %>
                                        </span>
                                    </td>
                                    <td>
                                        <%= new Date(order.delivery_date).toLocaleDateString() %>
                                        <br>
                                        <small class="text-muted">
                                            <% 
                                                const deliveryDate = new Date(order.delivery_date);
                                                const today = new Date();
                                                const diffTime = deliveryDate - today;
                                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                            %>
                                            <% if (diffDays > 0) { %>
                                                <%= diffDays %> days to go
                                            <% } else if (diffDays === 0) { %>
                                                Today
                                            <% } else { %>
                                                <%= Math.abs(diffDays) %> days ago
                                            <% } %>
                                        </small>
                                    </td>
                                    <td>
                                        <% if (order.status === 'pending' || order.status === 'confirmed') { %>
                                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                                    onclick="OrderManager.cancelOrder(<%= order.id %>, this)"
                                                    title="<%= __('cancelOrder') %>">
                                                <i data-feather="x" style="width: 14px; height: 14px;"></i>
                                            </button>
                                        <% } else { %>
                                            <span class="text-muted">-</span>
                                        <% } %>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <div class="text-center py-5">
                    <i data-feather="shopping-cart" style="width: 64px; height: 64px;" class="text-muted mb-3"></i>
                    <h5 class="text-muted"><%= __('title') %></h5>
                    <p class="text-muted mb-4"><%= __('description') %></p>
                    <a href="/vendor/contracts" class="btn btn-primary">
                        <i data-feather="search" class="me-2"></i>
                        <%= __('browseContracts') %>
                    </a>
                </div>
            <% } %>
        </div>
    </div>

 
        
       
    </div>
</div>

<style>
.border-left-primary { border-left: 4px solid var(--primary-color) !important; }
.border-left-warning { border-left: 4px solid var(--warning-color) !important; }
.border-left-success { border-left: 4px solid var(--success-color) !important; }
.border-left-info { border-left: 4px solid var(--primary-color) !important; }

@media print {
    .btn, .card-header .d-flex > div:last-child {
        display: none !important;
    }
}
</style>

<script>
// Status filter functionality
document.getElementById('statusFilter').addEventListener('change', function() {
    const selectedStatus = this.value;
    const rows = document.querySelectorAll('.order-row');
    
    rows.forEach(row => {
        if (selectedStatus === '' || row.dataset.status === selectedStatus) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});
</script>
